<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="format-detection" content="telephone=no" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<link rel="shortcut icon" href="/favicon.ico?v=1.0" />
	<link rel="bookmark" href="/favicon.ico?v=1.0" type="image/x-icon"/>
	<meta name="google-site-verification" content="pz-ce-l_gQDa6VYnlRFQ9_zPjFd_RjdKQIYuQo3KOa4" />
	<meta name="baidu-site-verification" content="vk6cCdHgcY" />

	
<link rel="stylesheet" href="/fontawesome/css/all.css">

	
<link rel="stylesheet" href="/css/main.css">

	
	
	
	
		<title>JavaScript函数式编程(一) | HiramGao</title>
		
<link rel="stylesheet" href="/css/post.css">

	
	
	<meta name="author" content="HiramGao>">
    
	<meta name="description" content="为什么要用函数式，因为爽！！！！JS函数式编程指南JavaScript函数式编程两本不一样underscorejs确保理解JavaScript的闭包和作用域
基础知识明白下面概念

JavaScript中纯函数是一等公民 什么叫做纯函数 12345function add(a,b)&amp;#123;a,b">
    

    
    
	<meta name="keywords" content="JavaScript,函数式编程">
    
<meta name="generator" content="Hexo 5.4.0"></head>


	<body class="">
		<div id="loading-wrapper">
    <div class="loadingio-spinner-pulse-0j4n9nav3jfo">
        <div class="ldio-0e7i9lcrxe4">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
</div>
<style type="text/css">
    @keyframes ldio-0e7i9lcrxe4-1 {
        0% {
            top: 36px;
            height: 128px
        }

        50% {
            top: 60px;
            height: 80px
        }

        100% {
            top: 60px;
            height: 80px
        }
    }

    @keyframes ldio-0e7i9lcrxe4-2 {
        0% {
            top: 41.99999999999999px;
            height: 116.00000000000001px
        }

        50% {
            top: 60px;
            height: 80px
        }

        100% {
            top: 60px;
            height: 80px
        }
    }

    @keyframes ldio-0e7i9lcrxe4-3 {
        0% {
            top: 48px;
            height: 104px
        }

        50% {
            top: 60px;
            height: 80px
        }

        100% {
            top: 60px;
            height: 80px
        }
    }

    .ldio-0e7i9lcrxe4 div {
        position: absolute;
        width: 30px
    }

    .ldio-0e7i9lcrxe4 div:nth-child(1) {
        left: 35px;
        background: #51cacc;
        animation: ldio-0e7i9lcrxe4-1 1s cubic-bezier(0, 0.5, 0.5, 1) infinite;
        animation-delay: -0.2s
    }

    .ldio-0e7i9lcrxe4 div:nth-child(2) {
        left: 85px;
        background: #9df871;
        animation: ldio-0e7i9lcrxe4-2 1s cubic-bezier(0, 0.5, 0.5, 1) infinite;
        animation-delay: -0.1s
    }

    .ldio-0e7i9lcrxe4 div:nth-child(3) {
        left: 135px;
        background: #e0ff77;
        animation: ldio-0e7i9lcrxe4-3 1s cubic-bezier(0, 0.5, 0.5, 1) infinite;
        animation-delay: undefineds
    }

    .loadingio-spinner-pulse-0j4n9nav3jfo {
        width: 200px;
        height: 200px;
        display: block;
        overflow: hidden;
        background: none;
        margin: auto;
    }

    .ldio-0e7i9lcrxe4 {
        width: 100%;
        height: 100%;
        position: relative;
        transform: translateZ(0) scale(1);
        backface-visibility: hidden;
        transform-origin: 0 0;
        /* see note above */
    }

    .ldio-0e7i9lcrxe4 div {
        box-sizing: content-box;
    }

    /* generated by https://loading.io/ */
</style>
<script>
    document.onreadystatechange = function () {
        if (document.readyState == 'complete') {
            document.getElementById('loading-wrapper').style.display = 'none';
        }
    };
</script>
		<div class="progress">
    <span class="progress-indicator" id="progress-indicator"></span>
</div>
		<div class="max-width-4 mx-auto">
			<div class="clearfix">
				<section id="sidebar" class="sidebar lg-col sm-col-12 lg-col-3 mx-auto mt2 center hvr-shadow-radial block">
  <div id="sidebar-toggle" class="sidebar-toggle">
	<input class="l" checked type="checkbox">
</div>
  <div class="sidebar-main">
    <img id="avatar" src="/images/avatar.jpg" class="author-image mx-auto block border p1 circle mt3">
    <h3 class="author-name">HiramGao</h3>
    <p class="motto">行远必自迩，登高必自卑</p>
    <nav class="site-info mt3">
      <div class="inline-block site-info-item px2">
        <a href="/archives" class="text-decoration-none">
          <span class="site-info-name block">POSTS</span>
          <span class="site-info-count">9</span>
        </a>
      </div>
      <div class="inline-block site-info-item px2">
        <a href="/tags" class="text-decoration-none">
          <span class="site-info-name block">TAGS</span>
          <span class="site-info-count">10</span>
        </a>
      </div>
    </nav>
    <div class="feed-link mt3 mb3">
      <a class="text-decoration-none inline-block mx-auto" href="/atom.xml"><img src="/images/rss.png" alt=""> RSS</a>
    </div>
  </div>
  <div class="copyright mt1 pt1 pb1 absolute">© 2017-2020 hiramgao <br>Powered by <a target="_blank" href="https://hexo.io/" rel="external nofollow noopener">Hexo.</a> <br>Theme by <a target="_blank" href="https://github.com/HiramGao/hexo-theme-QAQ" rel="external nofollow noopener">hiramgao</a></div>

</section>

				<section id="context" class="content sm-col sm-col-12 lg-col-8 border-box pl2 animated fadeInRightBig faster">
  <nav class="navigation mt2 list-reset py2 animated slideInDown faster hvr-shadow-radial block">
    <li class="inline-block mx2">
        
        <a class="text-decoration-none py1" href="/">首页</a>
        
    </li>
    <li class="inline-block mx2">
        
        <a class="text-decoration-none py1" href="/archives">归档</a>
        
    </li>
    <li class="inline-block mx2">
        
        <a class="text-decoration-none py1" href="/tags">标签</a>
        
    </li>
    <li class="inline-block mx2">
        <a class="text-decoration-none py1" href="https://hiramgao.github.io/cv/" target="_blank">关于我</a>
    </li>
    <li class="inline-block mx2 search">
        
    </li>
</nav>

  <article class="post mt1 p2 mb3">
  <header class="post-header my1 pb2">
    <h1 class="m0 center">JavaScript函数式编程(一)</h1>
    <small class="time center block">
      发表于&nbsp;<time>2017-03-28</time>
    </small>
  </header>
  <nav class="catalog mt1 mb1 pb1">
    <div class="catalog-title mt2 mb1">
      目录
    </div>
    <div class="catalog-body">
      <ol class="catalog-list"><li class="catalog-list-item catalog-list-level-2"><a class="catalog-list-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="catalog-list-text">基础知识</span></a></li><li class="catalog-list-item catalog-list-level-2"><a class="catalog-list-link" href="#%E5%AE%9E%E6%88%98%E6%BC%94%E7%BB%83"><span class="catalog-list-text">实战演练</span></a></li></ol>
    </div>
  </nav>

  <section class="post-body markdown-body px1 pb2">
    <p>为什么要用函数式，因为爽！！！！<br><a target="_blank" rel="noopener" href="https://www.gitbook.com/book/llh911001/mostly-adequate-guide-chinese/details">JS函数式编程指南</a><br><a target="_blank" rel="noopener" href="https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B01264FOY4/ref=sr_1_1?ie=UTF8&qid=1490667646&sr=8-1&keywords=javascript%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B">JavaScript函数式编程</a><br>两本不一样<br><a target="_blank" rel="noopener" href="http://underscorejs.org/">underscorejs</a><br>确保理解JavaScript的闭包和作用域</p>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>明白下面概念</p>
<ol>
<li>JavaScript中纯函数是一等公民<br> 什么叫做<strong>纯函数</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a,b</span>)</span>&#123;a,b)</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line">add(<span class="number">1</span>,<span class="number">2</span>) <span class="comment">/*3*/</span></span><br><span class="line">add(<span class="number">1</span>,<span class="number">2</span>) <span class="comment">/*3*/</span></span><br></pre></td></tr></table></figure>
 纯函数是指<strong>不依赖且不改变它作用域之外的变量状态</strong>的函数。下面的是非纯函数 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addWithC</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b + c</span><br><span class="line">&#125;</span><br><span class="line">addWithC(<span class="number">1</span>,<span class="number">2</span>)<span class="comment">/*4*/</span></span><br><span class="line">c = <span class="number">2</span></span><br><span class="line">addWith(<span class="number">1</span>,<span class="number">2</span>) <span class="comment">/*5*/</span></span><br></pre></td></tr></table></figure>
 为什么说js中函数是一等公民<br> 函数可以作为变量、数组元素、对象成员、作为参数、作为return 对象，可以去任何值的地方，所以是一等的公民。</li>
<li>高阶函数<br> 以一个函数作为参数，以一个函数作为返回结果就为<strong>高阶函数</strong>。 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addWithC</span>(<span class="params">fn, a, b</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fn.call(<span class="built_in">this</span>,a, b) + c</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">addWithC(add,<span class="number">1</span>,<span class="number">2</span>)(<span class="number">3</span>) <span class="comment">/*6*/</span></span><br></pre></td></tr></table></figure></li>
<li>柯里化<br> 将多个参数的函数转变为接受单一参数的函数 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span>  a + b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> addWith10 = (<span class="function"><span class="keyword">function</span> <span class="title">addWith10</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> add.call(<span class="built_in">this</span>,<span class="number">10</span>, a)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)()</span><br><span class="line">addWith10(<span class="number">1</span>) <span class="comment">/*11*/</span></span><br><span class="line">addWith10(<span class="number">2</span>) <span class="comment">/*12*/</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="实战演练"><a href="#实战演练" class="headerlink" title="实战演练"></a>实战演练</h2><p>有了基本概念就可以开始实战了<br>定义几个输出信息的函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fail</span>(<span class="params">thing</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(thing)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">warn</span>(<span class="params">thing</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.warn([<span class="string">&quot;WARNING:&quot;</span>, thing].join(<span class="string">&#x27; &#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">note</span>(<span class="params">thing</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log([<span class="string">&quot;NOTE:&quot;</span>, thing].join(<span class="string">&#x27; &#x27;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义两个常用函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*检查值是否为null和undefined*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">existy</span>(<span class="params">x</span>)</span>&#123; <span class="keyword">return</span> x != <span class="literal">null</span>&#125;</span><br><span class="line"><span class="comment">//判断x是否被认为是true的同义词</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">truthy</span>(<span class="params">x</span>)</span>&#123; <span class="keyword">return</span> (x !== <span class="literal">false</span> &amp;&amp; existy(x))&#125;</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>,<span class="literal">null</span>,<span class="literal">false</span>,<span class="literal">undefined</span>].map(existy)</span><br><span class="line"><span class="comment">/*[true, false, true, false]*/</span></span><br><span class="line">[<span class="number">1</span>,<span class="literal">null</span>,<span class="literal">false</span>,<span class="literal">undefined</span>].map(truthy)</span><br><span class="line"><span class="comment">/*[true, false, false, false]*/</span></span><br></pre></td></tr></table></figure>
<p>那么就可以代替以下操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(condition)</span><br><span class="line">		<span class="keyword">return</span> _.isFunction(doSomething) ? doSomething() : doSomething;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doWhen</span>(<span class="params">cond, action</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(truthy(cond))</span><br><span class="line">		<span class="keyword">return</span> action();</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回常量的函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">always</span>(<span class="params">VALUE</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> VALUE;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f = always(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;)</span><br><span class="line">f() === f() <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>在来几个基本函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> head = _.first(<span class="built_in">arguments</span>);</span><br><span class="line">	<span class="keyword">if</span>(existy(head))&#123;</span><br><span class="line">		<span class="keyword">return</span> head.concat.apply(head, _.rest(<span class="built_in">arguments</span>));</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> [];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">cat([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>],[<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]) <span class="comment">/*[1, 2, 3, 4, 5, 6, 7, 8, 9]*/</span></span><br><span class="line"><span class="comment">/*第一个*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">construct</span>(<span class="params">head, tail</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> cat([head], _.toArray(tail))</span><br><span class="line">&#125;</span><br><span class="line">construct(<span class="number">42</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">/*[42, 1, 2, 3]*/</span></span><br><span class="line"><span class="comment">/*第二个*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapcat</span>(<span class="params">fun, coll</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> cat.apply(<span class="literal">null</span>, _.map(coll,fun))</span><br><span class="line">&#125;</span><br><span class="line">mapcat(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> construct(e,[<span class="string">&#x27;,&#x27;</span>]);</span><br><span class="line">&#125;,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">/*[1, &quot;,&quot;, 2, &quot;,&quot;, 3, &quot;,&quot;]*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">butLast</span>(<span class="params">coll</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _.toArray(coll).slice(<span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">interpost</span>(<span class="params">inter, coll</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> butLast(mapcat(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> construct(e, [inter]);</span><br><span class="line">    &#125;, coll))</span><br><span class="line">&#125;</span><br><span class="line">interpost(<span class="string">&quot;,&quot;</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">//[1, &quot;,&quot;, 2, &quot;,&quot;, 3]</span></span><br></pre></td></tr></table></figure>
<p>invoker:接受一个方法，并在任何给定的对象上调用它</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invoker</span>(<span class="params">NAME,METHOD</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target <span class="comment">/*args...*/</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!existy(target)) fail(<span class="string">&#x27;must provide a target&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> targetMethod = target[NAME];</span><br><span class="line">        <span class="keyword">var</span> args = _.rest(<span class="built_in">arguments</span>);</span><br><span class="line">        <span class="keyword">return</span> doWhen((existy(targetMethod) &amp;&amp; METHOD === targetMethod),</span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> targetMethod.apply(target,args)</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rev = invoker(<span class="string">&#x27;reverse&#x27;</span>,<span class="built_in">Array</span>.prototype.reverse)</span><br><span class="line"></span><br><span class="line">rev([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="comment">//[3, 2, 1]</span></span><br></pre></td></tr></table></figure>
<p>防止不存在的函数：full</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="literal">null</span>,<span class="number">5</span>]</span><br><span class="line"><span class="built_in">Array</span>.prototype.reduce.call(nums,<span class="function"><span class="keyword">function</span>(<span class="params">total,n</span>)</span>&#123;<span class="keyword">return</span> total * n&#125;); <span class="comment">/*0*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fnull</span>(<span class="params">fun <span class="comment">/*,default*/</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> defaults = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"><span class="comment">/*args*/</span></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.map.call(<span class="built_in">arguments</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e, i</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">return</span> existy(e) ? e : defaults[i];</span><br><span class="line">		&#125;);</span><br><span class="line">		<span class="keyword">return</span> fun.apply(fun, args)</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> safeMult = fnull(<span class="function"><span class="keyword">function</span>(<span class="params">total,n</span>)</span>&#123;<span class="keyword">return</span> total * n&#125;, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">Array</span>.prototype.reduce.call(nums,safeMult); <span class="comment">/*30*/</span></span><br><span class="line"></span><br><span class="line">可以这样使用</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defaults</span>(<span class="params">d</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">o, k</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> val = fnull(_.identity,d[k])</span><br><span class="line">		<span class="keyword">return</span> o &amp;&amp; val(o[k]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params">config</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> lookup = defaults(&#123;<span class="attr">critical</span>:<span class="number">108</span>&#125;);</span><br><span class="line">	<span class="keyword">return</span> lookup(config, <span class="string">&#x27;critical&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(doSomething(&#123;<span class="attr">critical</span>:<span class="number">9</span>&#125;)) <span class="comment">/*9*/</span></span><br><span class="line"><span class="built_in">console</span>.log(doSomething(&#123;&#125;)) <span class="comment">//108</span></span><br></pre></td></tr></table></figure>
<p>利用invoker 如果调用到目标对象不具有的方法会返回undefined，可以组合多个invoker 形成多态函数，或者根据不同参数产生不同行为的函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params"><span class="comment">/* funs */</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> funs = _.toArray(<span class="built_in">arguments</span>);</span><br><span class="line">	<span class="keyword">var</span> size = funs.length;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target <span class="comment">/*, args*/</span></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> ret = <span class="literal">undefined</span>;</span><br><span class="line">		<span class="keyword">var</span> args = _.rest(<span class="built_in">arguments</span>);</span><br><span class="line">		<span class="keyword">var</span> fun;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> funIndex = <span class="number">0</span>; funIndex &lt; size; funIndex++) &#123;</span><br><span class="line">			fun = funs[funIndex];</span><br><span class="line">			ret = fun.apply(fun, construct(target,args))</span><br><span class="line">			<span class="keyword">if</span>(existy(ret)) <span class="keyword">return</span> ret;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> ret</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str = dispatch(</span><br><span class="line">	invoker(<span class="string">&#x27;toString&#x27;</span>,<span class="built_in">Array</span>.prototype.toString),</span><br><span class="line">	invoker(<span class="string">&#x27;toString&#x27;</span>,<span class="built_in">String</span>.prototype.toString)</span><br><span class="line">	)</span><br><span class="line">str(<span class="string">&quot;a&quot;</span>) <span class="comment">/*&quot;a&quot;*/</span></span><br><span class="line">str([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]) <span class="comment">//&quot;1,2,3,4&quot;</span></span><br></pre></td></tr></table></figure>
<p>当然也可以这样做</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stringReverse</span>(<span class="params">s</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!_.isString(s)) <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">	<span class="keyword">return</span> s.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stringReverse(<span class="string">&quot;abc&quot;</span>) <span class="comment">/*&quot;cba&quot;*/</span></span><br><span class="line">stringReverse(<span class="number">1</span>) <span class="comment">/*undefined*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rev = dispatch(</span><br><span class="line">	invoker(<span class="string">&#x27;reverse&#x27;</span>,<span class="built_in">Array</span>.prototype.reverse),</span><br><span class="line">	stringReverse</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">rev([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">/*[3,2,1]*/</span></span><br><span class="line">rev(<span class="string">&#x27;abc&#x27;</span>) <span class="comment">// &quot;cba&quot;</span></span><br></pre></td></tr></table></figure>
<p>还可以继续包装返回默认值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sillyReverse = dispatch(rev,always(<span class="number">42</span>));</span><br><span class="line">sillyReverse([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">//[3,2,1]</span></span><br><span class="line">sillyReverse(<span class="string">&#x27;abc&#x27;</span>)<span class="comment">//&#x27;cba&#x27;</span></span><br><span class="line">sillyReverse(<span class="number">10000</span>) <span class="comment">//42</span></span><br></pre></td></tr></table></figure>
<p>这个函数基本可以取代switch case</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isa</span>(<span class="params">type, action</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(type === obj.type)&#123;</span><br><span class="line">			<span class="keyword">return</span> action(obj)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> performCommand = dispatch(</span><br><span class="line">	isa(<span class="string">&#x27;notify&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">&#x27;notify&#x27;</span>); <span class="keyword">return</span> <span class="literal">true</span>&#125;),</span><br><span class="line">	isa(<span class="string">&#x27;join&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">&#x27;join&#x27;</span>); <span class="keyword">return</span> <span class="literal">true</span>&#125;),</span><br><span class="line">	<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">&#x27;alert&#x27;</span>)&#125;</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">performCommand(&#123;<span class="attr">type</span>:<span class="string">&#x27;notify&#x27;</span>&#125;) <span class="comment">/*notify*/</span></span><br><span class="line">performCommand(&#123;<span class="attr">type</span>:<span class="string">&#x27;join&#x27;</span>&#125;) <span class="comment">/*join*/</span></span><br><span class="line">performCommand(&#123;<span class="attr">type</span>:<span class="string">&#x27;other&#x27;</span>&#125;) <span class="comment">/*alert*/</span></span><br></pre></td></tr></table></figure>
<p>可以很轻松的扩展</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> performAdminCommand = dispatch(</span><br><span class="line">	isa(<span class="string">&#x27;kill&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">&#x27;kill&#x27;</span>);<span class="keyword">return</span> <span class="literal">true</span>;&#125;),</span><br><span class="line">	performCommand</span><br><span class="line">	)</span><br><span class="line">performAdminCommand(&#123;<span class="attr">type</span>:<span class="string">&#x27;notify&#x27;</span>&#125;) </span><br><span class="line">performAdminCommand(&#123;<span class="attr">type</span>:<span class="string">&#x27;join&#x27;</span>&#125;)</span><br><span class="line">performAdminCommand(&#123;<span class="attr">type</span>:<span class="string">&#x27;kill&#x27;</span>&#125;) <span class="comment">/*kill*/</span></span><br><span class="line">performAdminCommand(&#123;<span class="attr">type</span>:<span class="string">&#x27;other&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>可以实现重载</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> performTrialUserCommand = dispatch(</span><br><span class="line">	isa(<span class="string">&#x27;join&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">&#x27;user join&#x27;</span>);<span class="keyword">return</span> <span class="literal">true</span>;&#125;),</span><br><span class="line">	performCommand</span><br><span class="line">	)</span><br><span class="line">performTrialUserCommand(&#123;<span class="attr">type</span>:<span class="string">&#x27;notify&#x27;</span>&#125;)</span><br><span class="line">performTrialUserCommand(&#123;<span class="attr">type</span>:<span class="string">&#x27;join&#x27;</span>&#125;) <span class="comment">/*user join*/</span></span><br><span class="line">performTrialUserCommand(&#123;<span class="attr">type</span>:<span class="string">&#x27;other&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>写一个自动柯里化参数的函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fun</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fun(arg)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>待续</p>

  </section>

  
<script src="/js/highlight.pack.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      var codeBlock = [].slice.call(document.getElementsByTagName('pre'));
      codeBlock.forEach(function(b,i){
        hljs.highlightBlock(b);
      });
    });
  </script>
</article>

  <div class="back-to-top-wrapper">
    <div class="back-to-top">Top</div>
</div>

</section>

			</div>
		</div>
	</body>
	
<script src="/js/jquery.min.js"></script>

	
<script src="/js/js.cookie.min.js"></script>

	<script>
		$.Cookies = window.Cookies
	</script>
	
<script src="/js/main.js"></script>

</html>
